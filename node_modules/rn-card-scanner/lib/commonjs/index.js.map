{"version":3,"names":["ComponentName","ComponentVisionName","CardScanner","ref","didCardScan","frameColor","PermissionCheckingComponent","NotAuthorizedComponent","disabled","useAppleVision","props","viewId","setViewId","useState","isPermissionChecked","setIsPermissionChecked","isAuthorized","setIsAuthorized","isEnableAppleVision","Platform","OS","parseInt","Version","useEffect","checkCameraPermission","then","isGranted","useImperativeHandle","Commands","UIManager","getViewManagerConfig","toggleFlashId","getCommandId","toggleFlash","resetResultId","resetResult","startCameraId","startScanCard","stopCameraId","stopScanCard","dispatchViewManagerCommand","startCamera","stopCamera","_onDidScanCard","res","nativeEvent","styles","authorization","authorizationText","CardScannerComponent","CardScannerVision","CardScannerView","StyleSheet","absoluteFill","r","findNodeHandle","forwardRef","create","flex","alignItems","justifyContent","textAlign","padding","hasCameraPermissions","permissionStatus","PermissionsAndroid","request","PERMISSIONS","CAMERA","RESULTS","GRANTED","NativeModules","requestPermission","status","error","commandId","select","android","default","LINKING_ERROR","ios","requireNativeComponent","Error"],"sources":["index.tsx"],"sourcesContent":["import React, {\n  forwardRef,\n  ReactElement,\n  useEffect,\n  useImperativeHandle,\n  useState,\n} from 'react';\nimport {\n  ActivityIndicator,\n  findNodeHandle,\n  NativeModules,\n  NativeSyntheticEvent,\n  PermissionsAndroid,\n  Platform,\n  requireNativeComponent,\n  StyleSheet,\n  Text,\n  UIManager,\n  View,\n  ViewProps,\n} from 'react-native';\n\nexport interface CardScannerResponse {\n  cardNumber?: string;\n  expiryYear?: string;\n  expiryMonth?: string;\n  holderName?: string;\n}\n\nexport interface CardScannerHandle {\n  toggleFlash(): void;\n  resetResult(): void;\n  startCamera(): void;\n  stopCamera(): void;\n}\n\ninterface CardScannerProps extends ViewProps {\n  didCardScan?: (props: CardScannerResponse) => void;\n  frameColor?: string;\n  PermissionCheckingComponent?: ReactElement;\n  NotAuthorizedComponent?: ReactElement;\n  disabled?: boolean;\n  useAppleVision?: boolean;\n}\n\nconst ComponentName = 'CardScannerView';\nconst ComponentVisionName = 'CardScannerVision';\n\nconst CardScanner: React.ForwardRefRenderFunction<\n  CardScannerHandle,\n  CardScannerProps\n> = (\n  {\n    didCardScan,\n    frameColor,\n    PermissionCheckingComponent,\n    NotAuthorizedComponent,\n    disabled,\n    useAppleVision,\n    ...props\n  },\n  ref\n) => {\n  const [viewId, setViewId] = useState<number | null>(null);\n  const [isPermissionChecked, setIsPermissionChecked] = useState(false);\n  const [isAuthorized, setIsAuthorized] = useState(false);\n\n  const isEnableAppleVision =\n    useAppleVision &&\n    Platform.OS === 'ios' &&\n    parseInt(Platform.Version, 10) >= 13;\n\n  useEffect(() => {\n    checkCameraPermission().then((isGranted: boolean) => {\n      setIsAuthorized(isGranted);\n      setIsPermissionChecked(true);\n    });\n  }, []);\n\n  useImperativeHandle(\n    ref,\n    () => {\n      const Commands = UIManager.getViewManagerConfig(\n        isEnableAppleVision ? ComponentVisionName : ComponentName\n      ).Commands;\n\n      const toggleFlashId = getCommandId(Commands.toggleFlash);\n      const resetResultId = getCommandId(Commands.resetResult);\n      const startCameraId = getCommandId(Commands.startScanCard);\n      const stopCameraId = getCommandId(Commands.stopScanCard);\n\n      return {\n        toggleFlash() {\n          UIManager.dispatchViewManagerCommand(viewId, toggleFlashId, []);\n        },\n        resetResult() {\n          UIManager.dispatchViewManagerCommand(viewId, resetResultId, []);\n        },\n        startCamera() {\n          UIManager.dispatchViewManagerCommand(viewId, startCameraId, []);\n        },\n        stopCamera() {\n          UIManager.dispatchViewManagerCommand(viewId, stopCameraId, []);\n        },\n      };\n    },\n    [viewId, isEnableAppleVision]\n  );\n\n  const _onDidScanCard = (res: NativeSyntheticEvent<CardScannerResponse>) => {\n    didCardScan && didCardScan(res.nativeEvent);\n  };\n\n  if (!isPermissionChecked) {\n    if (PermissionCheckingComponent) {\n      return PermissionCheckingComponent;\n    }\n\n    return (\n      <View style={styles.authorization}>\n        <ActivityIndicator color=\"#293462\" />\n      </View>\n    );\n  }\n\n  if (!isAuthorized) {\n    if (NotAuthorizedComponent) {\n      return NotAuthorizedComponent;\n    }\n\n    return (\n      <View style={styles.authorization}>\n        <Text style={styles.authorizationText}>\n          Need \"Camera Permission\" to scan your card\n        </Text>\n      </View>\n    );\n  }\n\n  const CardScannerComponent = isEnableAppleVision\n    ? CardScannerVision\n    : CardScannerView;\n\n  return (\n    <View {...props}>\n      {!disabled && (\n        <CardScannerComponent\n          style={StyleSheet.absoluteFill}\n          onDidScanCard={_onDidScanCard}\n          ref={(r: any) => {\n            setViewId(findNodeHandle(r));\n          }}\n          frameColor={frameColor}\n        />\n      )}\n    </View>\n  );\n};\n\nexport default forwardRef(CardScanner);\n\nconst styles = StyleSheet.create({\n  authorization: { flex: 1, alignItems: 'center', justifyContent: 'center' },\n  authorizationText: { textAlign: 'center', padding: 16 },\n});\n\nconst checkCameraPermission = async () => {\n  try {\n    let hasCameraPermissions = false;\n    if (Platform.OS === 'android') {\n      const permissionStatus = await PermissionsAndroid.request(\n        PermissionsAndroid.PERMISSIONS.CAMERA\n      );\n      hasCameraPermissions =\n        permissionStatus === PermissionsAndroid.RESULTS.GRANTED;\n    } else {\n      const permissionStatus =\n        await NativeModules.CardScanner.requestPermission();\n      hasCameraPermissions = permissionStatus.status === 'granted';\n    }\n    return hasCameraPermissions;\n  } catch (error) {\n    return false;\n  }\n};\n\nconst getCommandId = (commandId: number) =>\n  Platform.select<string | number>({\n    android: `${commandId}`,\n    default: commandId,\n  });\n\ninterface ScannerNativeProps extends ViewProps {\n  ref: any;\n  onDidScanCard: (props: NativeSyntheticEvent<CardScannerResponse>) => void;\n  frameColor?: string;\n}\n\nconst LINKING_ERROR =\n  `The package 'rn-card-scanner' doesn't seem to be linked. Make sure: \\n\\n` +\n  Platform.select({ ios: \"- You have run 'pod install'\\n\", default: '' }) +\n  '- You rebuilt the app after installing the package\\n' +\n  '- You are not using Expo managed workflow\\n';\n\nconst CardScannerView =\n  UIManager.getViewManagerConfig(ComponentName) != null\n    ? requireNativeComponent<ScannerNativeProps>(ComponentName)\n    : () => {\n        throw new Error(LINKING_ERROR);\n      };\n\nconst CardScannerVision =\n  UIManager.getViewManagerConfig(ComponentVisionName) != null\n    ? requireNativeComponent<ScannerNativeProps>(ComponentVisionName)\n    : () => {\n        throw new Error(LINKING_ERROR);\n      };\n"],"mappings":"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"}