{"version":3,"names":["React","forwardRef","useEffect","useImperativeHandle","useState","ActivityIndicator","findNodeHandle","NativeModules","PermissionsAndroid","Platform","requireNativeComponent","StyleSheet","Text","UIManager","View","ComponentName","ComponentVisionName","CardScanner","ref","didCardScan","frameColor","PermissionCheckingComponent","NotAuthorizedComponent","disabled","useAppleVision","props","viewId","setViewId","isPermissionChecked","setIsPermissionChecked","isAuthorized","setIsAuthorized","isEnableAppleVision","OS","parseInt","Version","checkCameraPermission","then","isGranted","Commands","getViewManagerConfig","toggleFlashId","getCommandId","toggleFlash","resetResultId","resetResult","startCameraId","startScanCard","stopCameraId","stopScanCard","dispatchViewManagerCommand","startCamera","stopCamera","_onDidScanCard","res","nativeEvent","styles","authorization","authorizationText","CardScannerComponent","CardScannerVision","CardScannerView","absoluteFill","r","create","flex","alignItems","justifyContent","textAlign","padding","hasCameraPermissions","permissionStatus","request","PERMISSIONS","CAMERA","RESULTS","GRANTED","requestPermission","status","error","commandId","select","android","default","LINKING_ERROR","ios","Error"],"sources":["index.tsx"],"sourcesContent":["import React, {\n  forwardRef,\n  ReactElement,\n  useEffect,\n  useImperativeHandle,\n  useState,\n} from 'react';\nimport {\n  ActivityIndicator,\n  findNodeHandle,\n  NativeModules,\n  NativeSyntheticEvent,\n  PermissionsAndroid,\n  Platform,\n  requireNativeComponent,\n  StyleSheet,\n  Text,\n  UIManager,\n  View,\n  ViewProps,\n} from 'react-native';\n\nexport interface CardScannerResponse {\n  cardNumber?: string;\n  expiryYear?: string;\n  expiryMonth?: string;\n  holderName?: string;\n}\n\nexport interface CardScannerHandle {\n  toggleFlash(): void;\n  resetResult(): void;\n  startCamera(): void;\n  stopCamera(): void;\n}\n\ninterface CardScannerProps extends ViewProps {\n  didCardScan?: (props: CardScannerResponse) => void;\n  frameColor?: string;\n  PermissionCheckingComponent?: ReactElement;\n  NotAuthorizedComponent?: ReactElement;\n  disabled?: boolean;\n  useAppleVision?: boolean;\n}\n\nconst ComponentName = 'CardScannerView';\nconst ComponentVisionName = 'CardScannerVision';\n\nconst CardScanner: React.ForwardRefRenderFunction<\n  CardScannerHandle,\n  CardScannerProps\n> = (\n  {\n    didCardScan,\n    frameColor,\n    PermissionCheckingComponent,\n    NotAuthorizedComponent,\n    disabled,\n    useAppleVision,\n    ...props\n  },\n  ref\n) => {\n  const [viewId, setViewId] = useState<number | null>(null);\n  const [isPermissionChecked, setIsPermissionChecked] = useState(false);\n  const [isAuthorized, setIsAuthorized] = useState(false);\n\n  const isEnableAppleVision =\n    useAppleVision &&\n    Platform.OS === 'ios' &&\n    parseInt(Platform.Version, 10) >= 13;\n\n  useEffect(() => {\n    checkCameraPermission().then((isGranted: boolean) => {\n      setIsAuthorized(isGranted);\n      setIsPermissionChecked(true);\n    });\n  }, []);\n\n  useImperativeHandle(\n    ref,\n    () => {\n      const Commands = UIManager.getViewManagerConfig(\n        isEnableAppleVision ? ComponentVisionName : ComponentName\n      ).Commands;\n\n      const toggleFlashId = getCommandId(Commands.toggleFlash);\n      const resetResultId = getCommandId(Commands.resetResult);\n      const startCameraId = getCommandId(Commands.startScanCard);\n      const stopCameraId = getCommandId(Commands.stopScanCard);\n\n      return {\n        toggleFlash() {\n          UIManager.dispatchViewManagerCommand(viewId, toggleFlashId, []);\n        },\n        resetResult() {\n          UIManager.dispatchViewManagerCommand(viewId, resetResultId, []);\n        },\n        startCamera() {\n          UIManager.dispatchViewManagerCommand(viewId, startCameraId, []);\n        },\n        stopCamera() {\n          UIManager.dispatchViewManagerCommand(viewId, stopCameraId, []);\n        },\n      };\n    },\n    [viewId, isEnableAppleVision]\n  );\n\n  const _onDidScanCard = (res: NativeSyntheticEvent<CardScannerResponse>) => {\n    didCardScan && didCardScan(res.nativeEvent);\n  };\n\n  if (!isPermissionChecked) {\n    if (PermissionCheckingComponent) {\n      return PermissionCheckingComponent;\n    }\n\n    return (\n      <View style={styles.authorization}>\n        <ActivityIndicator color=\"#293462\" />\n      </View>\n    );\n  }\n\n  if (!isAuthorized) {\n    if (NotAuthorizedComponent) {\n      return NotAuthorizedComponent;\n    }\n\n    return (\n      <View style={styles.authorization}>\n        <Text style={styles.authorizationText}>\n          Need \"Camera Permission\" to scan your card\n        </Text>\n      </View>\n    );\n  }\n\n  const CardScannerComponent = isEnableAppleVision\n    ? CardScannerVision\n    : CardScannerView;\n\n  return (\n    <View {...props}>\n      {!disabled && (\n        <CardScannerComponent\n          style={StyleSheet.absoluteFill}\n          onDidScanCard={_onDidScanCard}\n          ref={(r: any) => {\n            setViewId(findNodeHandle(r));\n          }}\n          frameColor={frameColor}\n        />\n      )}\n    </View>\n  );\n};\n\nexport default forwardRef(CardScanner);\n\nconst styles = StyleSheet.create({\n  authorization: { flex: 1, alignItems: 'center', justifyContent: 'center' },\n  authorizationText: { textAlign: 'center', padding: 16 },\n});\n\nconst checkCameraPermission = async () => {\n  try {\n    let hasCameraPermissions = false;\n    if (Platform.OS === 'android') {\n      const permissionStatus = await PermissionsAndroid.request(\n        PermissionsAndroid.PERMISSIONS.CAMERA\n      );\n      hasCameraPermissions =\n        permissionStatus === PermissionsAndroid.RESULTS.GRANTED;\n    } else {\n      const permissionStatus =\n        await NativeModules.CardScanner.requestPermission();\n      hasCameraPermissions = permissionStatus.status === 'granted';\n    }\n    return hasCameraPermissions;\n  } catch (error) {\n    return false;\n  }\n};\n\nconst getCommandId = (commandId: number) =>\n  Platform.select<string | number>({\n    android: `${commandId}`,\n    default: commandId,\n  });\n\ninterface ScannerNativeProps extends ViewProps {\n  ref: any;\n  onDidScanCard: (props: NativeSyntheticEvent<CardScannerResponse>) => void;\n  frameColor?: string;\n}\n\nconst LINKING_ERROR =\n  `The package 'rn-card-scanner' doesn't seem to be linked. Make sure: \\n\\n` +\n  Platform.select({ ios: \"- You have run 'pod install'\\n\", default: '' }) +\n  '- You rebuilt the app after installing the package\\n' +\n  '- You are not using Expo managed workflow\\n';\n\nconst CardScannerView =\n  UIManager.getViewManagerConfig(ComponentName) != null\n    ? requireNativeComponent<ScannerNativeProps>(ComponentName)\n    : () => {\n        throw new Error(LINKING_ERROR);\n      };\n\nconst CardScannerVision =\n  UIManager.getViewManagerConfig(ComponentVisionName) != null\n    ? requireNativeComponent<ScannerNativeProps>(ComponentVisionName)\n    : () => {\n        throw new Error(LINKING_ERROR);\n      };\n"],"mappings":"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"}